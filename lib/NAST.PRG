Parameter COLOR
Private C
Declare NAST(4, 6)
NAST(1, 1)=1
NAST(1, 2)=1
NAST(1, 3)=3
NAST(1, 4)=10
NAST(1, 5)=109
NAST(1, 6)=40
NAST(2, 1)=1
NAST(2, 2)=13
NAST(2, 3)=4
NAST(2, 4)=18
NAST(2, 5)=78
NAST(2, 6)=60
NAST(3, 1)=5
NAST(3, 2)=1
NAST(3, 3)=9
NAST(3, 4)=18
NAST(3, 5)=132
NAST(3, 6)=63
NAST(4, 1)=5
NAST(4, 2)=21
NAST(4, 3)=11
NAST(4, 4)=31
NAST(4, 5)=109
NAST(4, 6)=88
STORE 0 TO RMAR, RMAL
DO DEFA WITH M -> COLOR, 'w+/rb,w+/bg,gr+/rb,gr+/rb,gr+/rb,w+/b'
DEFINE WINDOW WNAST FROM 4, 21 TO 19, 55 SHADOW TITLES ' Фoрмат листа ';
 FOOTER ' Выбoр - Enter   Изменить-F6 ' COLOR (m.COLOR)
Wait Clear
ACTIVATE WINDOW NOSHOW WNAST
IF FILES('prinastr.mem')
	RESTORE FROM prinastr ADDITIVE
ENDIF
IF FILES('pri.mem')
	RESTORE FROM pri ADDITIVE
	RELEASE RMA
ENDIF
Private KEY, I, J, N
J=5
N=4
FOR I=1 TO N
	@ NAST(I,1), NAST(I,2) TO NAST(I,3), NAST(I,4)
	DO SAYW
	IF J=5 and NAST(I,5)=m.RMAR and NAST(I,6)=m.RMAL
		J=I
	ENDIF
ENDFOR
I=J
RELEASE J
IF I<5 and (NAST(I,5)<>m.RMAR.OR.NAST(I,6)<>m.RMAL)
	I=N+1
ENDIF
@ 12, 1 SAY 'Прoизвoльный фoрмат      x'
= GM()
OLD=m.RMAR
C=SCHM(m.COLOR,6)
COLOR=SCHM(m.COLOR,1)
ACTIVATE WINDOW SAME WNAST
DO WHILE .T.
	IF I=5
		ON KEY LABEL F6 Clea Read
		READ SAVE
		ON KEY LABEL F6 
		KEY=LASTKEY()
	ELSE
		@ NAST(I,1), NAST(I,2) FILL TO NAST(I,3), NAST(I,4) COLOR (m.C)
		KEY=INKEY(0,'hm')
		@ NAST(I,1), NAST(I,2) FILL TO NAST(I,3), NAST(I,4) COLOR (m.COLOR)
	ENDIF
	IF KEY=27
		RMAR=m.OLD
		RELEASE OLD
		EXIT
	ENDIF
	IF KEY=13.OR.KEY=151
		IF I<>5
			RMAR=NAST(I,5)
			RMAL=NAST(I,6)
		ENDIF
		EXIT
	ENDIF
	IF KEY=-5
		FOR I=1 TO N
			@ NAST(I,1), COLC() GET NAST(I, 5) SIZE 1, 3 PICTURE '@z'
			@ ROWC(), NAST(I,4)-2 GET NAST(I, 6) SIZE 1, 3 PICTURE '@z'
		ENDFOR
		=ACOPY(RMA,A)
		READ CYCLE OBJECT 3
		=UPDATED() and !MENU02('Запoмнить значения') and ACOPY(A,RMA)=1
		RELEASE A
		FOR I=1 TO N
			DO SAYW
		ENDFOR
		=GM()
	ELSE
		I=IIF(INLIST(KEY,5,15,18,19),IIF(I=1,N+1,I-1),IIF(I=N+1,1,I+1))
	ENDIF
ENDDO
RELEASE WINDOW WNAST
CLEAR GETS
IF m.RMAR=0
	RMAR=NAST(1,5)
ENDIF
IF m.RMAL=0
	RMAL=NAST(1,6)
ENDIF
SAVE TO pri ALL LIKE rma*
C=SYS(2004)+'prinastr'
Save All Like nast* to &c
Return LASTKEY()<>27

Proc GM
	@ 12, 22 GET RMAR SIZE 1, 3 PICTURE '@z'
	@ 12, 28 GET RMAL SIZE 1, 3 PICTURE '@z'
Return

Proc ROWC
Return NAST(I,1)+INT((NAST(I,3)-NAST(I,1))/2)

Proc COLC
Return NAST(I,2)+MAX(INT((NAST(I,4)-NAST(I,2))/2)-1,2)

Proc SAYW
	@ NAST(I,1), COLC() SAY NAST(I,5) SIZE 1, 3 PICTURE '@z'
	@ ROWC(), NAST(I,4)-2 SAY NAST(I,6) SIZE 1, 3 PICTURE '@z'
Return
